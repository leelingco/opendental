//
// Translated by CS2J (http://www.cs2j.com): 2/15/2016 8:01:41 PM
//

package MobileWeb;

import CS2JNet.System.StringSupport;
import MobileWeb.Util;
import WebForms.Logger;


//------------------------------------------------------------------------------// <auto-generated>//     This code was generated by a tool.////     Changes to this file may cause incorrect behavior and will be lost if//     the code is regenerated.// </auto-generated>//------------------------------------------------------------------------------
public class ProcessLogin  extends System.Web.UI.Page 
{

    private Util util = new Util();
    private String LoginFailedMessage = "Login Failed. Please try again";
    private long DentalOfficeID = 0;
    protected void page_Load(Object sender, EventArgs e) throws Exception {
        try
        {
            //delete later util.SetMobileDbConnection();//connects to db if not already connected.
            String username = "";
            String password = "";
            boolean RememberMe = false;
            Message.Text = "";
            if (Request.Form["username"] != null)
            {
                username = Request.Form["username"].ToString().Trim();
            }
             
            if (Request.Form["password"] != null)
            {
                password = Request.Form["password"].ToString().Trim();
            }
             
            if (Request.Form["rememberusername"] != null)
            {
                if (StringSupport.equals(Request.Form["rememberusername"].ToString().Trim(), "true"))
                {
                    RememberMe = true;
                }
                 
            }
             
            DentalOfficeID = util.getDentalOfficeID(username,password);
            //DentalOfficeID=;// !!! or testing only comment out this line on prod
            if (DentalOfficeID > 0)
            {
                Session["CustomerNum"] = DentalOfficeID;
                Message.Text = "CorrectLogin";
            }
            else
            {
                Message.Text = LoginFailedMessage;
            } 
            HttpCookie UserNameCookie = new HttpCookie("UserNameCookie");
            if (RememberMe)
            {
                UserNameCookie.Value = username;
                UserNameCookie.Expires = DateTime.Now.AddYears(1);
                Response.Cookies.Add(UserNameCookie);
            }
            else
            {
                UserNameCookie.Expires = DateTime.Now.AddDays(-1);
                Response.Cookies.Add(UserNameCookie);
            } 
        }
        catch (Exception ex)
        {
            Message.Text = LoginFailedMessage;
            Logger.logError(ex);
        }
    
    }

    /**
    * Message control.
    * 
    * Auto-generated field.
    * To modify move field declaration from designer file to code-behind file.
    */
    protected System.Web.UI.WebControls.Literal Message = new System.Web.UI.WebControls.Literal();
}


